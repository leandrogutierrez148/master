<html><head>
    <meta charset="UTF-8">
    <title>M1B1T2_AI1: Plataforma como servicio (PaaS) en AWS</title>
    <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
*  Copyright (c) Microsoft Corporation. All rights reserved.
*  Licensed under the MIT License. See License.txt in the project root for license information.
*--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only] {
display: none;
}

</style>
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
        font-size: 14px;
        line-height: 1.6;
    }
</style>
<style>
.task-list-item {
list-style-type: none;
}

.task-list-item-checkbox {
margin-left: -20px;
vertical-align: middle;
pointer-events: none;
}
</style>
<style>
:root {
--color-note: #0969da;
--color-tip: #1a7f37;
--color-warning: #9a6700;
--color-severe: #bc4c00;
--color-caution: #d1242f;
--color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
:root {
--color-note: #2f81f7;
--color-tip: #3fb950;
--color-warning: #d29922;
--color-severe: #db6d28;
--color-caution: #f85149;
--color-important: #a371f7;
}
}

</style>
<style>
.markdown-alert {
padding: 0.5rem 1rem;
margin-bottom: 16px;
color: inherit;
border-left: .25em solid #888;
}

.markdown-alert>:first-child {
margin-top: 0
}

.markdown-alert>:last-child {
margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
display: flex;
font-weight: 500;
align-items: center;
line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
margin-right: 0.5rem;
display: inline-block;
overflow: visible !important;
vertical-align: text-bottom;
fill: currentColor;
}

.markdown-alert.markdown-alert-note {
border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
color: var(--color-caution);
}

pre {
background-color: rgb(248, 245, 245);
}

img, video {
max-width: 60%;
max-height: 60%;
}
</style>

</head>
<body class="vscode-body vscode-light">
    <h1 id="m1b1t2_ai1-plataforma-como-servicio-paas-en-aws">M1B1T2_AI1: Plataforma como servicio (PaaS) en AWS</h1>
<h4 id="autor-leandro-gutierrez">Autor: Leandro Gutierrez</h4>
<h4 id="este-documento-intenta-dar-respuesta-a-las-actividades-propuestas-en-el-modulo-1-bloque-1-tema-2-del-master-en-big-data-y-ciencia-de-datos-en-él-se-describirán-cada-uno-de-los-enunciados-postulados-y-los-resultados-obtenidos-utilizando-la-plataforma-amazon-aws-su-servicio-rds-amazon-relational-database-service-y-la-base-de-datos-relacional-postgresql">Este documento intenta dar respuesta a las actividades propuestas en el Modulo 1 Bloque 1 Tema 2 del Master en Big Data y Ciencia de Datos. En él se describirán cada uno de los enunciados postulados y los resultados obtenidos utilizando la plataforma Amazon AWS, su servicio RDS (Amazon Relational DataBase Service), y la base de datos relacional PostgreSQL.</h4>
<h4 id="abril-29-2024">Abril 29, 2024</h4>
<hr>
<h3 id="descripción">Descripción</h3>
<p>Has sido contratado como Data Engineer por una empresa dedicada al mundo del deporte. Dentro de su estrategia definida para los próximos años, está empezando un proyecto para migrar sus aplicaciones a la nube. Para ello, ha elegido Amazon Web Services (AWS) como proveedor de servicios en la nube.</p>
<p>La multinacional tiene en sus instalaciones una base de datos relacional PostgreSQL, donde almacenan resultados de diferentes deportes.</p>
<p>El CDO (Chief Data Officer) ha decidido migrar a AWS, utilizando el servicio Amazon RDS (Amazon Relational DataBase Service) por las ventajas que ofrece usar un servicio PaaS.</p>
<p>Para la migración, han hecho una exportación de las diferentes tablas a ficheros de texto. Una de ellas contiene los resultados de la Liga Española de fútbol.</p>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/schema.jpeg" alt="aws-schema"></p>
<h1 id="sección-aws-rds">Sección AWS RDS</h1>
<ul>
<li>Crear una base de datos PostgreSQL en AWS utilizando el servicio Amazon RDS.</li>
<li>Una vez creada la base de datos, crear una tabla para almacenar los datos.</li>
<li>Importar los datos del archivo “Partidos.txt” en la tabla creada.</li>
</ul>
<h3 id="procedimiento">Procedimiento</h3>
<ul>
<li>Una vez iniciado el laboratorio desde <a href="https://awsacademy.instructure.com">https://awsacademy.instructure.com</a> y habiendo ingresado a la plataforma <strong>AWS</strong>, nos dirijimos al servicio <strong>Amazon RDS</strong> el cual nos brinda la capacidad de iniciar una base de datos relacional en la nube de manera sencilla.</li>
</ul>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/aws/0.png" alt="aws-0"></p>
<ul>
<li>Una vez dentro del servicio RDS, seleccionamos la opcion "Crear Base de Datos", aquí debemos seleccionar el motor que estemos necesitando, en nuestro caso utilizaremos <strong>PostgreSQL</strong></li>
</ul>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/aws/1.png" alt="aws-1"></p>
<ul>
<li>Dentro de las configuraciones de nuestra DB PostgreSQL, vamos a seleccionar la plantilla <strong>Capa gratuita</strong>, la cual preconfigurará ciertos parametros para adaptarlos a nuestro caso de uso.</li>
</ul>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/aws/2.png" alt="aws-2"></p>
<ul>
<li>Siguiendo con las configuraciones de nuestra base de datos, los demás parametros de configuración deben quedar como se muestra en las siguientes capturas de pantalla</li>
</ul>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/aws/3.png" alt="aws-3"></p>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/aws/4.png" alt="aws-4"></p>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/aws/5.png" alt="aws-5"></p>
<ul>
<li>Una vez seteadas las configuraciones mostradas, damos en <strong>Crear base de datos</strong></li>
</ul>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/aws/6.png" alt="aws-6"></p>
<ul>
<li>Esta accicón nos llevará de nuevo al panel principal de RDS, donde al cabo de unos minutos veremos la siguiente notificación y tendremos lista nuestra instancia</li>
</ul>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/aws/8.png" alt="aws-8"></p>
<ul>
<li>Para poder acceder desde fuera de la infraestructura cloud de AWS necesitaremos configurar el firewall de nuestra instacia de Postgres, para ello crearemos un <strong>Grupo de seguridad</strong> en el cual indicaremos que vamos a habilitar el acceso al puerto donde está corriendo nuestra base de datos (TCP:5432). Esto lo conseguimos creando una regla de entrada dentro de nuestro grupo de seguridad.</li>
</ul>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/aws/9.png" alt="aws-9"></p>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/aws/10.png" alt="aws-10"></p>
<ul>
<li>Quedando nuestra <strong>Grupo de seguridad</strong> como muestra la siguiente captura de pantalla</li>
</ul>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/aws/11.png" alt="aws-11"></p>
<ul>
<li>
<p>Ahora si ya tenemos configurada y accesible nuestra base de datos Postgres en Amazon.</p>
</li>
<li>
<p>Para conectarnos de manera remota utilizaremos DBeaver como cliente SQL, configurando la conexión en función de los datos que AWS nos provea y de las credenciales que hayamos utilizado durante la creación de la instacia</p>
</li>
</ul>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/aws/12.png" alt="aws-12"></p>
<ul>
<li>Testeamos que tengamos conectividad y deberiamos ver el siguiente mensaje de éxito</li>
</ul>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/aws/13.png" alt="aws-13"></p>
<ul>
<li>Una vez conectados a la DB lo proximo será importar los datos, para ello lo primero será crear un schema, en este caso lo llamé <em>partidos</em>, luego debemos hacer click secundario sobre nuestro schema creado y clickear <strong>Import Data</strong></li>
</ul>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/aws/18.png" alt="aws-18"></p>
<ul>
<li>En la nueva ventana que se abre debemos seleccionar CSV y buscar nuestro archivo. <strong>NOTA: como paso intermedio edité el archivo modificando el separador original por comas (,) y agregué la cabecera con los nombres de las columna segun indica el enunciado</strong></li>
</ul>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/aws/14.png" alt="aws-14"></p>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/aws/15.png" alt="aws-15"></p>
<ul>
<li>Culminada la importación, hacemos un checkeo de los datos con una consulta sencilla</li>
</ul>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> partidos
</code></pre>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/aws/17.png" alt="aws-17" style="
margin-bottom: 450px;
"></p>
<h1 id="sección-sql">Sección SQL</h1>
<h3 id="ejercicio-1">Ejercicio 1</h3>
<blockquote>
<p>¿Cuántos goles ha marcado el Barcelona?</p>
</blockquote>
<h4 id="sql">SQL</h4>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> 	<span class="hljs-built_in">SUM</span>(<span class="hljs-keyword">CASE</span> 
        <span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">local</span> <span class="hljs-operator">=</span> <span class="hljs-string">'Barcelona'</span> <span class="hljs-keyword">THEN</span> goles_local
        <span class="hljs-keyword">ELSE</span> goles_visitante 
    <span class="hljs-keyword">END</span>) <span class="hljs-keyword">as</span> goles
<span class="hljs-keyword">FROM</span> partidos.partidos p 
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">local</span> <span class="hljs-operator">=</span> <span class="hljs-string">'Barcelona'</span> <span class="hljs-keyword">OR</span> visitante <span class="hljs-operator">=</span> <span class="hljs-string">'Barcelona'</span>;
</code></pre>
<h4 id="resultados">Resultados</h4>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/sql/1.png" alt="sql-1"></p>
<h4 id="respuesta">Respuesta</h4>
<p>El Barcelona a marcado un total de <strong>3.339</strong> goles.</p>
<h3 id="ejercicio-2">Ejercicio 2</h3>
<blockquote>
<p>¿Cuántos partidos han terminado 0-0?</p>
</blockquote>
<h4 id="sql-1">SQL</h4>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-number">1</span>)
<span class="hljs-keyword">FROM</span> partidos.partidos p 
<span class="hljs-keyword">WHERE</span> goles_local <span class="hljs-operator">=</span> <span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> goles_visitante  <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
</code></pre>
<h4 id="resultados-1">Resultados</h4>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/sql/2.png" alt="sql-2"></p>
<h4 id="respuesta-1">Respuesta</h4>
<p>En el dataset encontramos un total de <strong>3.511</strong> empates 0-0.</p>
<h3 id="ejercicio-3">Ejercicio 3</h3>
<blockquote>
<p>¿En qué temporada se han marcado más goles?</p>
</blockquote>
<h4 id="sql-2">SQL</h4>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> 	temporada,
<span class="hljs-built_in">SUM</span>(goles_local <span class="hljs-operator">+</span> goles_visitante) <span class="hljs-keyword">as</span> goles	
<span class="hljs-keyword">FROM</span> partidos.partidos p 
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> temporada
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> goles <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">1</span>;
</code></pre>
<h4 id="resultados-2">Resultados</h4>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/sql/3.png" alt="sql-3"></p>
<h4 id="respuesta-2">Respuesta</h4>
<p>La temporada 2012-13 es la que mas goles registró, con un total de <strong>2.224</strong></p>
<h3 id="ejercicio-4">Ejercicio 4</h3>
<blockquote>
<p>¿Cuál es el equipo que tiene el record de meter más goles como local? ¿Y cómo visitante?</p>
</blockquote>
<h4 id="sql-3">SQL</h4>
<pre><code class="language-sql"><span class="hljs-keyword">WITH</span> goles_local <span class="hljs-keyword">AS</span>(
<span class="hljs-keyword">SELECT</span> 	<span class="hljs-keyword">local</span> <span class="hljs-keyword">AS</span> equipo, 
    <span class="hljs-built_in">SUM</span>(goles_local) goles,
    <span class="hljs-built_in">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">SUM</span>(goles_local) <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> ranking
<span class="hljs-keyword">FROM</span> partidos.partidos p 
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">local</span>
), goles_visitante <span class="hljs-keyword">AS</span>(
<span class="hljs-keyword">SELECT</span> 	visitante <span class="hljs-keyword">AS</span> equipo,
    <span class="hljs-built_in">SUM</span>(goles_visitante) goles,
    <span class="hljs-built_in">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">SUM</span>(goles_visitante) <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> ranking
<span class="hljs-keyword">FROM</span> partidos.partidos 
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> visitante 
)
<span class="hljs-keyword">SELECT</span> <span class="hljs-string">'como local'</span> <span class="hljs-keyword">AS</span> "goleador", equipo, goles, ranking
<span class="hljs-keyword">FROM</span> goles_local gl
<span class="hljs-keyword">WHERE</span> ranking <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> 
<span class="hljs-keyword">SELECT</span> <span class="hljs-string">'como visitante'</span>, equipo, goles, ranking
<span class="hljs-keyword">FROM</span> goles_visitante gv
<span class="hljs-keyword">WHERE</span> ranking <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<h4 id="resultados-3">Resultados</h4>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/sql/4.png" alt="sql-4"></p>
<h4 id="respuesta-3">Respuesta</h4>
<p>El <strong>record de goles como local</strong> se lo lleva el <strong>Real Madrid</strong> con un total de <strong>2.054</strong> goles convertidos. Mientras que el <strong>record de goles como visitante</strong> lo comparten <strong>el Real Madrid y el Barcelona</strong> con un total de <strong>1.296</strong> goles marcados fuera de casa.</p>
<h3 id="ejercicio-5">Ejercicio 5</h3>
<blockquote>
<p>¿Cuál son las 3 décadas en las que más goles se metieron?</p>
</blockquote>
<h4 id="sql-4">SQL</h4>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> 	<span class="hljs-built_in">EXTRACT</span>(DECADE <span class="hljs-keyword">FROM</span> TO_DATE(fecha, <span class="hljs-string">'DD/MM/YYYY'</span>))<span class="hljs-operator">*</span><span class="hljs-number">10</span> <span class="hljs-keyword">AS</span> decada,
<span class="hljs-built_in">SUM</span>(goles_local <span class="hljs-operator">+</span> goles_visitante) goles
<span class="hljs-keyword">FROM</span> partidos.partidos p 
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> decada
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> goles <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">3</span>;
</code></pre>
<h4 id="resultados-4">Resultados</h4>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/sql/5.png" alt="sql-5"></p>
<h4 id="respuesta-4">Respuesta</h4>
<p>Las decadas de los <strong>2000, 1990 y 1980</strong> son las que lideran la estadística de mayor cantidad de goles por temporada.</p>
<h3 id="ejercicio-6">Ejercicio 6</h3>
<blockquote>
<p>¿Qué equipo es el mejor local en los últimos 5 años?</p>
</blockquote>
<h4 id="sql-5">SQL</h4>
<pre><code class="language-sql"><span class="hljs-keyword">WITH</span> ranking <span class="hljs-keyword">AS</span> (
<span class="hljs-keyword">SELECT</span> 	<span class="hljs-keyword">local</span> equipo, 
    <span class="hljs-built_in">SUM</span>(<span class="hljs-keyword">CASE</span>  
            <span class="hljs-keyword">WHEN</span> goles_local <span class="hljs-operator">&gt;</span> goles_visitante  <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span>
            <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span>
        <span class="hljs-keyword">END</span>) ganados,
    <span class="hljs-built_in">RANK</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">local</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> temporada <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> tempo
<span class="hljs-keyword">FROM</span> partidos.partidos p 
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">local</span>, temporada
)
<span class="hljs-keyword">SELECT</span> equipo, <span class="hljs-built_in">SUM</span>(ganados) ganados_total
<span class="hljs-keyword">FROM</span> ranking
<span class="hljs-keyword">WHERE</span> tempo <span class="hljs-operator">&lt;=</span> <span class="hljs-number">5</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> equipo
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> ganados_total <span class="hljs-keyword">DESC</span> 
LIMIT <span class="hljs-number">1</span>;
</code></pre>
<h4 id="resultados-5">Resultados</h4>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/sql/6.png" alt="sql-6"></p>
<h4 id="respuesta-5">Respuesta</h4>
<p>El <strong>Barcelona</strong> es el equipo que registra la mayor cantidad de partidos ganados como local, con un total <strong>82 partidos</strong> en las últimas 5 temporadas de las que se tienen datos.</p>
<h3 id="ejercicio-7">Ejercicio 7</h3>
<blockquote>
<p>¿Cuál es la media de victorias por temporada en los equipos que han estado menos de 10 temporadas en 1ª división?</p>
<p>El resultado tiene que ser una tabla con dos columnas: Equipo | Media de victorias por temporada</p>
</blockquote>
<h4 id="sql-6">SQL</h4>
<pre><code class="language-sql" style="
font-size: smaller;
"><span class="hljs-keyword">WITH</span> victorias_local <span class="hljs-keyword">AS</span> (
<span class="hljs-keyword">SELECT</span> 	<span class="hljs-keyword">local</span> equipo, 
    temporada,
    <span class="hljs-built_in">SUM</span>(<span class="hljs-keyword">CASE</span>  
            <span class="hljs-keyword">WHEN</span> goles_local <span class="hljs-operator">&gt;</span> goles_visitante  <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span>
            <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span>
        <span class="hljs-keyword">END</span>) ganados
<span class="hljs-keyword">FROM</span> partidos.partidos p 
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">local</span>, temporada
), victorias_visitante <span class="hljs-keyword">AS</span> (
<span class="hljs-keyword">SELECT</span> 	visitante  equipo, 
    temporada,
    <span class="hljs-built_in">SUM</span>(<span class="hljs-keyword">CASE</span>  
            <span class="hljs-keyword">WHEN</span> goles_visitante <span class="hljs-operator">&gt;</span> goles_local  <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span>
            <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span>
        <span class="hljs-keyword">END</span>) ganados
<span class="hljs-keyword">FROM</span> partidos.partidos p 
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> visitante, temporada
)
<span class="hljs-keyword">SELECT</span> 	vl.equipo, 
<span class="hljs-built_in">SUM</span>(vl.ganados<span class="hljs-operator">+</span>vv.ganados)<span class="hljs-operator">/</span><span class="hljs-built_in">COUNT</span>(<span class="hljs-number">1</span>) media
<span class="hljs-keyword">FROM</span> victorias_local vl
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> victorias_visitante vv <span class="hljs-keyword">ON</span> vv.equipo <span class="hljs-operator">=</span> vl.equipo <span class="hljs-keyword">AND</span> vl.temporada <span class="hljs-operator">=</span> vv.temporada
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> vl.equipo
<span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-number">1</span>) <span class="hljs-operator">&lt;</span> <span class="hljs-number">10</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> equipo <span class="hljs-keyword">ASC</span>;
</code></pre>
<h4 id="resultados-6">Resultados</h4>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/sql/7.png" alt="sql-7"></p>
<p><strong>Nota: la imagen muestra los primeros 20 equipos en orden alfabético que no jugaron mas de 10 temporadas en primera y sus respectivas medias de victorias</strong></p>
<h4 id="respuesta-6">Respuesta</h4>
<p>El listado de la imagen superior muestra los equipos que no llegaron a jugar mas de 10 temporadas en primera, el total de equipos en esta situación es de 58.</p>
<h3 id="ejercicio-8">Ejercicio 8</h3>
<blockquote>
<p>¿Quién ha estado más temporadas en 1ª División: Barcelona o Real Madrid?</p>
</blockquote>
<h4 id="sql-7">SQL</h4>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> 	<span class="hljs-keyword">local</span>, 
<span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> temporada)
<span class="hljs-keyword">FROM</span> partidos.partidos
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">local</span> <span class="hljs-keyword">IN</span> (<span class="hljs-string">'Barcelona'</span>, <span class="hljs-string">'Real Madrid'</span>)
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">LOCAL</span>;
</code></pre>
<h4 id="resultados-7">Resultados</h4>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/sql/8.png" alt="sql-8"></p>
<h4 id="respuesta-7">Respuesta</h4>
<p style="
margin-bottom: 100px;
">Tanto <strong>Real Madrid</strong> como <strong>Barcelona</strong> jugaron <strong>45 temporadas</strong> en 1ra, según los datos que se tienen.</p>
<h3 id="ejercicio-9">Ejercicio 9</h3>
<blockquote>
<p>¿Cuál es el record de goles como visitante en una temporada del Real Madrid?</p>
</blockquote>
<h4 id="sql-8">SQL</h4>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span>  visitante , 
temporada, 
<span class="hljs-built_in">SUM</span>(goles_visitante) goles
<span class="hljs-keyword">FROM</span> partidos.partidos p 
<span class="hljs-keyword">WHERE</span> visitante <span class="hljs-operator">=</span> <span class="hljs-string">'Real Madrid'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> visitante, temporada
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> goles <span class="hljs-keyword">DESC</span> 
LIMIT <span class="hljs-number">1</span>;
</code></pre>
<h4 id="resultados-8">Resultados</h4>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/sql/9.png" alt="sql-9"></p>
<h4 id="respuesta-8">Respuesta</h4>
<p style="
margin-bottom: 700px;
">En la temporada <strong>2011-12</strong> el <strong>Real Madrid</strong> convirtió su <strong>record de goles como visitante</strong> en una única temporada, con un total 51 goles marcados fuera de casa.</p>
<h3 id="ejercicio-10">Ejercicio 10</h3>
<blockquote>
<p>¿En qué temporada se marcaron más goles en Cataluña?</p>
</blockquote>
<h4 id="sql-9">SQL</h4>
<pre><code class="language-sql" style="
font-size: small;
"><span class="hljs-keyword">WITH</span> goles_bcn <span class="hljs-keyword">AS</span> (
<span class="hljs-keyword">SELECT</span> 	<span class="hljs-keyword">local</span> equipo, 
    temporada,
    <span class="hljs-built_in">SUM</span>(goles_local<span class="hljs-operator">+</span>goles_visitante) total_goles,
    <span class="hljs-built_in">SUM</span>(goles_local) goles_hechos,
    <span class="hljs-built_in">SUM</span>(goles_visitante) goles_recibidos  
<span class="hljs-keyword">FROM</span> partidos.partidos p 
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">local</span> <span class="hljs-keyword">IN</span> (<span class="hljs-string">'Barcelona'</span>, <span class="hljs-string">'Espanyol'</span>)
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">local</span>, temporada
), mejor_temporada <span class="hljs-keyword">AS</span> (
<span class="hljs-keyword">SELECT</span>	temporada, 
    <span class="hljs-built_in">SUM</span>(total_goles) total_goles,
    <span class="hljs-built_in">SUM</span>(goles_hechos) total_goles_hechos,
    <span class="hljs-built_in">SUM</span>(goles_recibidos) total_goles_recibidos
<span class="hljs-keyword">FROM</span> goles_bcn
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> temporada
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> total_goles <span class="hljs-keyword">DESC</span> 
LIMIT <span class="hljs-number">1</span>
), total <span class="hljs-keyword">AS</span> (
<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> orden, m.temporada, g.equipo, g.goles_hechos, g.goles_recibidos, g.total_goles
<span class="hljs-keyword">FROM</span> goles_bcn g
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> mejor_temporada m <span class="hljs-keyword">ON</span> m.temporada <span class="hljs-operator">=</span> g.temporada
<span class="hljs-keyword">UNION</span> 
<span class="hljs-keyword">SELECT</span> <span class="hljs-number">2</span> orden, temporada, <span class="hljs-string">'Total'</span>, total_goles_hechos, total_goles_recibidos, total_goles 
<span class="hljs-keyword">FROM</span> mejor_temporada 
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> orden
)
<span class="hljs-keyword">SELECT</span> temporada, equipo, goles_hechos, goles_recibidos, total_goles 
<span class="hljs-keyword">FROM</span> total;

</code></pre>
<h4 id="resultados-9">Resultados</h4>
<p><img src="file:////Users/lgutierrez/Proyectos/master/M1B1/A4/images/sql/10.png" alt="sql-10"></p>
<h4 id="respuesta-9">Respuesta</h4>
<p>En la temporada <strong>2011-12</strong> fué en la que se convirtieron mas goles en <strong>Catalunya</strong>. Fueron un total de <strong>139 goles</strong>, de los cuales <strong>55</strong> se dieron durante encuentros del <strong>Espanyol</strong> (31 marcados + 24 recibidos) y <strong>84</strong> durante partidos del <strong>Barcelona</strong> (73 marcados + 11 recibidos).</p>

    
    

</body></html>